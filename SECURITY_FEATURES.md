# 登入安全保護機制

## 概述
本應用已實作多層次的安全保護機制，防止API遭受暴力破解攻擊。

## 已實作的安全功能

### 1. 登入嘗試次數限制
- **最大嘗試次數**: 5次
- **速率限制**: 每分鐘最多3次嘗試
- **功能**: 超過限制後自動鎖定帳戶

### 2. 帳戶鎖定機制
- **鎖定時間**: 15分鐘
- **觸發條件**: 連續5次登入失敗
- **解鎖方式**: 自動解鎖或管理員手動解鎖
- **狀態顯示**: 實時倒數計時器

### 3. 驗證碼保護
- **觸發條件**: 剩餘嘗試次數 ≤ 2次
- **類型**: 4位數字驗證碼
- **功能**: 防止自動化攻擊
- **刷新**: 可手動刷新驗證碼

### 4. 密碼強度驗證
- **最小長度**: 6位字符
- **強度指示器**: 實時顯示密碼強度
- **評級**: 弱/中等/強三個等級
- **建議**: 包含大小寫字母、數字、特殊字符

### 5. 輸入驗證
- **電子郵件格式**: 正則表達式驗證
- **密碼長度**: 最少6位字符
- **空值檢查**: 防止空輸入

### 6. 安全狀態顯示
- **嘗試次數**: 進度條顯示剩餘次數
- **警告提示**: 剩餘次數較少時顯示警告
- **鎖定狀態**: 顯示鎖定倒數計時

## 技術實現

### 數據存儲
使用 `SharedPreferences` 存儲安全相關數據：
- 登入嘗試次數
- 最後失敗時間
- 帳戶鎖定狀態
- 鎖定到期時間

### 安全配置
```dart
static const int maxLoginAttempts = 5;           // 最大嘗試次數
static const int lockoutDurationMinutes = 15;    // 鎖定時間（分鐘）
static const int maxAttemptsPerMinute = 3;       // 每分鐘最大嘗試次數
```

### 測試帳戶
為測試目的，提供以下測試帳戶：
- `test@example.com` / `password123`
- `admin@example.com` / `admin123`
- `user@example.com` / `user123`

## 使用方式

### 正常登入流程
1. 輸入電子郵件和密碼
2. 系統驗證輸入格式
3. 檢查帳戶鎖定狀態
4. 驗證登入憑證
5. 成功後重置嘗試次數

### 安全觸發流程
1. 登入失敗 → 增加嘗試次數
2. 剩餘次數 ≤ 2 → 顯示驗證碼
3. 達到最大次數 → 鎖定帳戶15分鐘
4. 鎖定期間 → 顯示倒數計時器

## 管理員功能

### 手動解鎖帳戶
```dart
await authProvider.unlockAccount('user@example.com');
```

### 查看鎖定狀態
```dart
bool isLocked = authProvider.isAccountLocked;
Duration? remainingTime = authProvider.getLockoutRemainingTime();
```

## 安全建議

### 生產環境部署
1. **後端API**: 將模擬驗證替換為真實API調用
2. **HTTPS**: 確保所有通信使用HTTPS
3. **JWT Token**: 實作JWT令牌認證
4. **數據庫**: 使用安全的數據庫存儲用戶數據
5. **日誌記錄**: 記錄所有登入嘗試和失敗

### 進階安全功能
1. **IP白名單**: 限制特定IP訪問
2. **地理位置檢查**: 檢測異常登入位置
3. **設備指紋**: 識別和驗證設備
4. **雙因素認證**: 實作2FA驗證
5. **密碼策略**: 更嚴格的密碼要求

### 監控和警報
1. **失敗嘗試監控**: 實時監控登入失敗
2. **異常行為檢測**: 檢測可疑登入模式
3. **自動警報**: 大量失敗時發送警報
4. **安全日誌**: 詳細記錄安全事件

## 文件結構
```
lib/
├── providers/
│   └── auth_provider.dart          # 認證提供者（包含安全邏輯）
├── widgets/
│   └── security_widgets.dart       # 安全相關UI組件
└── screens/
    └── login_screen.dart           # 登入畫面（整合安全功能）
```

## 注意事項
- 當前實現為演示版本，使用本地存儲
- 生產環境需要後端API支持
- 建議定期更新安全策略
- 保持安全功能的持續監控和改進
